# Dialog Flow для чат-бота выбора между магистратурами AI и AI Product (ИТМО)

## 1. Цель

Помочь абитуриенту:

* Понять разницу между программами **AI** и **AI Product**.
* Собрать профиль (бэкграунд, цели, предпочтения).
* Получить персональные рекомендации по курсам и траектории обучения.
* Задать вопросы по содержанию (курсы, пререквизиты, треки) — только в рамках этих двух программ.
* Отфильтровать нерелевантные запросы.

## 2. Основные команды / точки входа

* `/start` — онбординг, выбор действия.
* `/profile` — создать/редактировать профиль пользователя.
* `/compare` — сравнение двух программ.
* `/recommend` — получить траекторию под текущий профиль.
* `/reset` — сбросить сессию / контекст.
* `/help` — краткая подсказка по возможностям.

## 3. Интенты

1. `compare_programs` — «Чем отличается AI от AI Product?», «Что выбрать при моём профиле?»
2. `fill_profile` — ввод или изменение: бекграунд, цель, предпочтения.
3. `get_recommendation` — «Что мне брать, если…», «Какой путь обучения для моей цели?»
4. `course_detail` — запрос по конкретному курсу: пререквизиты, содержание, можно ли взять.
5. `path_explanation` — «Почему ты рекомендуешь именно эти курсы?»
6. `clarify` — неоднозначные/недостаточно определённые запросы, требует уточнения.
7. `fallback_non_relevant` — вне темы («Какая погода?», «Расскажи анекдот» и т.п.).

## 4. Онбординг ( `/start` )

**Бот:**
Приветственное сообщение с пояснением и кнопками:

* Сравнить программы
* Заполнить профиль
* Получить рекомендации
* Задать вопрос

**Пример:**

> Привет! Я помогу тебе выбрать между магистратурами **AI** и **AI Product** от ИТМО и построить персональную траекторию обучения. Что хочешь сделать первым?
> \[Сравнить] \[Профиль] \[Рекомендации] \[Вопрос]

## 5. Сбор профиля (`fill_profile`)

### 5.1 Шаги

1. **Бот:** «Расскажи о своём бэкграунде. Что у тебя есть: программирование, продукт, аналитика данных, ML, нет опыта?»

   * Варианты/чекбоксы: Программирование, Продукт, Data Science, Machine Learning, Без опыта.

2. **Бот:** «Какая у тебя цель после магистратуры?»

   * Варианты: AI Product Manager, ML Engineer, Исследователь, Гибрид (продукт+техника), Другое (с уточнением).

3. **Бот:** «Какие у тебя предпочтения по глубине и темпу?»

   * Примеры: Больше технической глубины / Больше продуктового фокуса / Быстро выйти на рынок / Сбалансированно.

4. **Бот:** «Хочешь ли, чтобы я сравнил программы под твой профиль сейчас?» (если профиль собран)

### 5.2 Хранение

Профиль сохраняется:

```json
{
  "background": ["Product", "Basic ML"],
  "goal": "AI Product Manager",
  "preferences": {
    "technical_depth": "medium",
    "pace": "fast",
    "focus": "product"
  },
  "selected_program": null
}
```

## 6. Сравнение программ (`compare_programs`)

**Триггеры:**
«Чем отличается AI и AI Product», «Что лучше для меня с моим профилем»

### 6.1 Поведение

* Если профиль есть: дополнительно персональная рекомендация (какая программа больше подходит и почему).
* Вывод таблицы по ключевым характеристикам:

  * Фокус (технический / продуктовый)
  * Типичные роли
  * Обязательные курсы / выборные направления
  * Примеры траекторий под цели
  * Преимущества для текущего профиля (если профиль задан)

### 6.2 Пример ответа

```
AI                  | AI Product
--------------------|--------------------------
Фокус: Технический  | Фокус: Продукт + AI
Роли: ML Engineer, Data Engineer | Роли: AI Product Manager, AI Strategist
Выборные: углублённые ML-модули | Выборные: управление продуктом, user research
Рекомендация: если хочешь глубоко заниматься моделями — AI. Если хочешь комбинировать продукт и AI — AI Product.
```

Если профиль:

> С твоим опытом в продукте и целью стать AI Product Manager — **AI Product** даёт лучшее сочетание продуктового мышления и базовой AI-компетенции.

## 7. Получение рекомендации (`get_recommendation`)

### 7.1 Триггеры

* «Что мне взять, чтобы стать AI Product Manager?»
* «Какую траекторию ты рекомендуешь при моём профиле?»
* «Какие выборные мне подойдут, если я — разработчик продукта?»

### 7.2 Логика

1. Берётся профиль.
2. Подбираются релевантные курсы / треки с учётом пререквизитов.
3. Строится последовательность по семестрам:

   * Основы (если нужно)
   * Выборные соответствующие цели
   * Углубления / альтернативы
4. Формируется объяснение (rationale) через OpenAI: почему такой путь, какие альтернативы при изменении цели/глубины.

### 7.3 Формат ответа

* **Шаг 1: Базовые курсы:** (если нужно)
* **Шаг 2: Рекомендуемые выборные:** с указанием причины
* **Шаг 3: Альтернативы:** для другого фокуса или глубины
* **Пример:**

  > 1. Первый семестр: обязательные основы X и Y (если нет знаний в анализе данных — сначала курс A).
  > 2. Второй: выборные по продуктовой аналитике и управлению (курсы B, C).
  > 3. Третий: углублённые AI-модули для принятия решений (курс D).
  >    Объяснение: твой продуктовый бекграунд сильный, поэтому важно усилить способность интерпретировать данные и применять модели в продуктовой среде.

## 8. Уточняющие шаги (`clarify`)

Если:

* Профиль неполон (например, «Хочу в AI Product» без бекграунда).
* Запрос неоднозначен («Какие курсы взять?» без цели).
* Нет уверенности в intent’е.

**Бот формирует уточняющий вопрос:**

* «Ты хочешь больше технического углубления или продуктового фокуса?»
* «Имеешь ли ты опыт в анализе данных? (да/нет)»
* «Под “какие курсы” ты имеешь в виду выборные, которые помогут в управлении продуктом, или технические углубления?»

## 9. Детали по курсам (`course_detail`)

**Примеры вопросов:**

* «Что за пререквизиты у курса X?»
* «Можно ли взять курс Y без курса Z?»
* «Входит ли курс A в трек продукта?»

**Ответ содержит:**

* Тип (обязательный/выборный)
* Пререквизиты и альтернативы
* Трек/роль, для которых полезен
* Краткое описание из парсера
* Если конфликт (нет базовых знаний) — рекомендация предварительного курса

## 10. Фильтрация нерелевантного (`fallback_non_relevant`)

**Примеры:** «Какая погода?», «Расскажи шутку», «Что там про футбол?»

**Поведение:**

> «Я могу отвечать только на вопросы, связанные с магистратурами AI и AI Product: сравнение, профиль, траектория, содержание курсов. Хочешь вернуться к выбору программы или обновить профиль?»
> Предлагает кнопки: \[Сравнить] \[Профиль] \[Рекомендации]

## 11. Управление контекстом

* Хранится:

  * Последний активный intent
  * Заполненный профиль
  * Выбранная/обсуждаемая программа
  * Последние уточняющие вопросы и их ответы

* Команды:

  * `/reset` — очищает сессию (профиль остаётся/или опционально можно сбросить)
  * `/profile` — показывает текущий профиль + позволяет его редактировать
  * `/recommend` — переинициирует рекомендацию по актуальному профилю
  * `/compare` — повторное сравнение с учётом обновлённого профиля

## 12. Промпты к OpenAI (структурированные)

### A. Классификация intent’а

```
Дан пользовательский запрос: "{user_message}".
Выбери один из intents: compare_programs, fill_profile, get_recommendation, course_detail, path_explanation, clarify, fallback_non_relevant.
Если запрос не относится к магистратурам AI / AI Product — верни fallback_non_relevant.
Ответи только названием intent'а.
```

### B. Генерация объяснения рекомендации

```
Ты — ассистент по академическому планированию. У абитуриента профиль: {profile}.
Цель: {goal}. У тебя есть набор релевантных курсов: {list_of_courses_with_tags_and_prereqs}.
Собери последовательную траекторию (семестры), объясни почему такой выбор, и предложи альтернативы для другого фокуса (если пользователь хочет больше технической глубины или больше продуктового акцента).
Ответи кратко, структурировано, без выдумок; упомяни только курсы из переданного списка.
```

### C. Формулировка уточняющего вопроса

```
Пользователь написал: "{user_message}".
Определи, что именно неясно или что нужно уточнить, чтобы дать релевантную рекомендацию или ответ. Сформулируй один ясный уточняющий вопрос.
```

## 13. Примеры диалогов

### Пример 1: Начало + профиль

```
/start
Бот: Что хочешь сделать? [Профиль]
Пользователь: Хочу стать AI Product Manager, у меня опыт в продукте.
Бот: Есть ли у тебя опыт в анализе данных? (Да/Нет)
Пользователь: Нет.
Бот: Рекомендую сначала курс по основам анализа данных, затем выборные по продуктовой аналитике и AI для принятия решений.
```

### Пример 2: Сравнение с профилем

```
Пользователь: Чем отличается AI от AI Product?
Бот: (таблица сравнения) + «С твоим бэкграундом в продукте лучше подходит AI Product, потому что...»
```

### Пример 3: Нерелевантный запрос

```
Пользователь: Какая погода в Петербурге?
Бот: Я могу отвечать только про магистратуры. Хочешь сравнить программы или обновить профиль?
```

## 14. Поведенческие правила

* **Не придумывать несуществующее.** Все рекомендации и объяснения опираются только на структурированную базу знаний.
* **Уточнять при сомнении.** Не давать уверенный путь, если профиль или цель неполные.
* **Краткость + структурированность.** Ответы разбиваются на блоки/списки.
* **Ранжирование.** Явно показывать: "основное", "рекомендуемое", "альтернатива".
* **Прозрачность.** Возможность спросить: «почему?» — и получить rationale (по весам/совпадениям).

## 15. Хранение сессии

Рекомендуется держать в Redis или в ArangoDB (временные объекты), поля:

* user\_id
* current\_intent
* profile\_id
* last\_question
* pending\_clarification (если есть)
* selected\_program (если в контексте)
